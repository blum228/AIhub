---
/**
 * Главная страница AIGirlsHub
 * Единственная точка входа: выбор цели → переход к сервисам
 */
import { getCollection } from 'astro:content';
import SiteLayout from '../layouts/SiteLayout.astro';
import Wrapper from '../components/Wrapper.astro';
import Space from '../components/Space.astro';
import SectionTitle from '../components/SectionTitle.astro';
import QuickPick from '../components/QuickPick.astro';
import { url } from '../utils/url';

// Получаем все модели для подсчёта
const allModels = await getCollection('models');
const models = allModels.map(entry => ({ 
  slug: entry.id.replace('.yaml', ''), 
  ...entry.data 
}));

// Группируем по мотивациям для статистики
const motivationCounts = {
  intimacy: models.filter(m => m.motivation === 'intimacy' || m.motivationSupport?.includes('intimacy')).length,
  escapism: models.filter(m => m.motivation === 'escapism' || m.motivationSupport?.includes('escapism')).length,
  connection: models.filter(m => m.motivation === 'connection' || m.motivationSupport?.includes('connection')).length,
};

// Мотивации пользователя — главная навигация
const motivations = [
  {
    id: 'intimacy',
    title: 'Интим',
    description: 'Флирт, романтика, NSFW-контент',
    icon: url('/images/icons/intimacy.svg'),
    count: motivationCounts.intimacy,
    href: url('/for/intimacy'),
    color: 'red',
  },
  {
    id: 'escapism',
    title: 'Эскапизм',
    description: 'Ролевые игры, персонажи, фантазии',
    icon: url('/images/icons/escapism.svg'),
    count: motivationCounts.escapism,
    href: url('/for/escapism'),
    color: 'purple',
  },
  {
    id: 'connection',
    title: 'Связь',
    description: 'Поддержка, дружба, разговоры',
    icon: url('/images/icons/connection.svg'),
    count: motivationCounts.connection,
    href: url('/for/connection'),
    color: 'blue',
  },
];

// FAQ для SEO
const faqItems = [
  {
    question: 'Что такое AI-девушка?',
    answer: 'Виртуальный компаньон на базе нейросетей. Помнит разговоры, генерирует фото, звонит голосом.'
  },
  {
    question: 'Это безопасно?',
    answer: 'Да. Данные шифруются. Не делись личными данными (адрес, карта) с любым AI.'
  },
  {
    question: 'Сколько стоит?',
    answer: 'От 0 до $20/мес. Character.AI бесплатный. Replika, Candy.AI — freemium от $7/мес.'
  },
  {
    question: 'Какую выбрать?',
    answer: 'Бесплатно — Character.AI. Фото — Candy.AI. Голос — Replika. NSFW — Muah AI.'
  }
];

// Schema.org
const schema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'AIGirlsHub',
  url: 'https://aigirlshub.ru',
  description: 'Каталог лучших AI-девушек и виртуальных компаньонов'
};

const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: faqItems.map(item => ({
    '@type': 'Question',
    name: item.question,
    acceptedAnswer: { '@type': 'Answer', text: item.answer }
  }))
};
---

<SiteLayout 
  title="AIGirlsHub — Каталог AI-девушек 2025"
  description="Найди идеальную AI-девушку. Обзоры и сравнения: Candy.AI, Character.AI, Replika."
>
  <script type="application/ld+json" set:html={JSON.stringify(schema)} slot="head" />
  <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} slot="head" />

  <!-- Hero: Главный вопрос -->
  <section class="hero">
    <Wrapper>
      <h1>Что ты ищешь?</h1>
      <p class="hero__sub">Выбери цель — мы подберём AI-девушку</p>
    </Wrapper>
  </section>

  <!-- УРОВЕНЬ 1: Выбор мотивации пользователя -->
  <Wrapper>
    <section class="goals">
      <div class="goals__grid">
        {motivations.map((motivation) => (
          <a href={motivation.href} class={`goal-card goal-card--${motivation.color}`}>
            <div class="goal-card__icon-wrapper">
              <img src={motivation.icon} alt={motivation.title} class="goal-card__icon" />
            </div>
            <div class="goal-card__content">
              <h3 class="goal-card__title">{motivation.title}</h3>
              <p class="goal-card__desc">{motivation.description}</p>
            </div>
            <span class="goal-card__count">{motivation.count}</span>
          </a>
        ))}
      </div>
    </section>
  </Wrapper>

  <Space size="L" />

  <!-- QuickPick: быстрый выбор -->
  <Wrapper>
    <QuickPick />
  </Wrapper>

  <Space size="L" />

  <!-- Превью сервисов -->
  <Wrapper>
    <section class="featured-services">
      <p class="featured-services__text">
        Candy.AI • Replika • Character.AI и ещё {models.length - 3} сервисов
      </p>
    </section>
  </Wrapper>

  <Space size="L" />

  <!-- Ссылка на все сервисы -->
  <Wrapper>
    <div class="all-services">
      <a href={url('/catalog')} class="all-services__link">
        Смотреть все {models.length} сервисов →
      </a>
    </div>
  </Wrapper>

  <Space size="XL" />

  <!-- FAQ -->
  <Wrapper>
    <section class="faq">
      <SectionTitle size="small">Частые вопросы</SectionTitle>
      <div class="faq__list">
        {faqItems.map((item, index) => (
          <details class="faq__item" open={index < 2}>
            <summary>{item.question}</summary>
            <p>{item.answer}</p>
          </details>
        ))}
      </div>
    </section>
  </Wrapper>

  <Space size="XL" />
</SiteLayout>

<style>
  /* ═══════════════════════════════════════════════════════════════
     HERO — Минималистичный
     ═══════════════════════════════════════════════════════════════ */
  .hero {
    padding: var(--ids__space-3xl) 0 var(--ids__space-xl);
    text-align: center;
  }

  .hero h1 {
    margin: 0;
    font-size: var(--ids__font-size-hero);
    font-weight: var(--ids__font-weight-heavy);
    letter-spacing: -0.02em;
    line-height: var(--ids__line-height-tight);
  }

  .hero__sub {
    margin: var(--ids__space-xs) 0 0;
    font-size: var(--ids__font-size-h3);
    color: var(--ids__text-secondary);
  }

  @media (width < 900px) {
    .hero h1 {
      font-size: var(--ids__font-size-hero-mobile);
    }
  }

  @media (width < 600px) {
    .hero {
      padding: var(--ids__space-2xl) 0 var(--ids__space-l);
    }
  }

  /* ═══════════════════════════════════════════════════════════════
     GOALS — Выбор цели (Уровень 1 сегментации)
     ═══════════════════════════════════════════════════════════════ */
  .goals__grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--ids__space-l);
  }

  @media (width < 900px) {
    .goals__grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--ids__space-m);
    }
  }

  @media (width < 600px) {
    .goals__grid {
      grid-template-columns: 1fr;
      gap: var(--ids__space-m);
    }
  }

  .goal-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--ids__space-m);
    padding: var(--ids__space-l);
    background: var(--ids__bg-surface);
    border: 1px solid var(--ids__border-subtle);
    border-radius: var(--ids__radius-l);
    text-decoration: none;
    color: inherit;
    text-align: center;
    transition: 
      border-color var(--ids__transition-normal),
      background var(--ids__transition-normal),
      transform var(--ids__transition-normal),
      box-shadow var(--ids__transition-normal);
  }

  .goal-card:hover {
    transform: translateY(-4px);
    border-color: var(--ids__border-default);
    background: var(--ids__bg-surface-hover);
    box-shadow: var(--ids__shadow-m);
  }

  .goal-card__icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 3em;
    height: 3em;
    border-radius: var(--ids__radius-m);
    background: var(--ids__bg-page);
    color: #000;
    transition: 
      background var(--ids__transition-normal),
      color var(--ids__transition-normal);
  }

  .goal-card__icon {
    width: 1.5em;
    height: 1.5em;
    display: block;
  }

  .goal-card:hover .goal-card__icon-wrapper {
    background: var(--ids__accent-subtle);
  }

  .goal-card__content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--ids__space-xs);
  }

  .goal-card__title {
    margin: 0;
    font-size: var(--ids__font-size-h3);
    font-weight: var(--ids__font-weight-bold);
    color: var(--ids__text-primary);
  }

  .goal-card__desc {
    margin: 0;
    font-size: var(--ids__font-size-small);
    color: var(--ids__text-secondary);
    line-height: var(--ids__line-height-relaxed);
  }

  .goal-card__count {
    font-size: var(--ids__font-size-caption);
    font-weight: var(--ids__font-weight-bold);
    color: var(--ids__text-muted);
    background: var(--ids__bg-page);
    padding: var(--ids__space-2xs) var(--ids__space-xs);
    border-radius: var(--ids__radius-full);
    flex-shrink: 0;
  }

  /* Цветовые акценты для карточек целей */
  .goal-card--red:hover .goal-card__icon-wrapper { background: rgba(239, 68, 68, 0.1); }
  .goal-card--purple:hover .goal-card__icon-wrapper { background: rgba(168, 85, 247, 0.1); }
  .goal-card--blue:hover .goal-card__icon-wrapper { background: rgba(59, 130, 246, 0.1); }
  .goal-card--green:hover .goal-card__icon-wrapper { background: rgba(34, 197, 94, 0.1); }
  .goal-card--orange:hover .goal-card__icon-wrapper { background: rgba(249, 115, 22, 0.1); }

  /* ═══════════════════════════════════════════════════════════════
     ALL SERVICES — Ссылка на каталог
     ═══════════════════════════════════════════════════════════════ */
  .all-services {
    text-align: center;
  }

  .all-services__link {
    font-size: var(--ids__font-size-body);
    font-weight: var(--ids__font-weight-semibold);
    color: var(--ids__accent);
  }

  .all-services__link:hover {
    text-decoration: underline;
  }

  /* ═══════════════════════════════════════════════════════════════
     FEATURED SERVICES — Превью сервисов
     ═══════════════════════════════════════════════════════════════ */
  .featured-services {
    text-align: center;
  }

  .featured-services__text {
    margin: 0;
    font-size: var(--ids__font-size-small);
    color: var(--ids__text-muted);
    letter-spacing: 0.02em;
  }

  /* ═══════════════════════════════════════════════════════════════
     FAQ
     ═══════════════════════════════════════════════════════════════ */
  /* SectionTitle handles h2 styling */

  .faq__list {
    display: flex;
    flex-direction: column;
    gap: var(--ids__space-2xs);
  }

  .faq__item {
    padding: var(--ids__space-s) var(--ids__space-m);
    background: transparent;
    border-radius: var(--ids__radius-s);
    cursor: pointer;
    transition: background var(--ids__transition-fast);
  }

  .faq__item:hover {
    background: var(--ids__bg-surface);
  }

  .faq__item[open] {
    background: var(--ids__bg-surface);
  }

  .faq__item summary {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: var(--ids__font-weight-semibold);
    color: var(--ids__text-primary);
    list-style: none;
    padding: 0;
  }

  .faq__item summary::after {
    content: '+';
    font-size: var(--ids__font-size-h3);
    font-weight: var(--ids__font-weight-normal);
    color: var(--ids__text-muted);
    transition: transform var(--ids__transition-fast);
  }

  .faq__item[open] summary::after {
    content: '−';
  }

  .faq__item summary::-webkit-details-marker {
    display: none;
  }

  .faq__item p {
    margin: var(--ids__space-s) 0 0;
    font-size: var(--ids__font-size-small);
    line-height: var(--ids__line-height-relaxed);
    color: var(--ids__text-secondary);
  }
</style>
