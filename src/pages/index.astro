---
/**
 * Главная страница AIGirlsHub
 * Стиль: nsfw.tools + СНГ фокус
 * Дизайн-система: IDS
 */
import { getCollection } from 'astro:content';
import SiteLayout from '../layouts/SiteLayout.astro';
import Wrapper from '../components/Wrapper.astro';
import ServiceCard from '../components/ServiceCard.astro';
import { url } from '../utils/url';

// Получаем модели
const allModels = await getCollection('models');
const models = allModels
  .map(entry => ({ 
    slug: entry.id.replace('.yaml', ''), 
    ...entry.data 
  }))
  .filter(m => m.status !== 'dead')
  .sort((a, b) => b.rating - a.rating);

// Топ-6 для главной
const topModels = models.slice(0, 6);

// Быстрые фильтры — без эмодзи, чище
const quickFilters = [
  { id: 'all', label: 'Все сервисы', href: url('/catalog') },
  { id: 'free', label: 'Бесплатные', href: url('/catalog?pricing=free') },
  { id: 'nsfw', label: 'Без цензуры', href: url('/catalog?nsfw=true') },
  { id: 'ru', label: 'Русский язык', href: url('/catalog?russian=true') },
  { id: 'mir', label: 'Оплата из РФ', href: url('/catalog?payment=mir') },
];

// FAQ — живой язык, конкретика
const faqItems = [
  { 
    q: 'Чем это отличается от ChatGPT?', 
    a: 'ChatGPT — это ассистент. Здесь — персонажи с характером, памятью и возможностью строить отношения. Многие сервисы позволяют то, что GPT запрещает.' 
  },
  { 
    q: 'Как платить из России?', 
    a: 'Часть сервисов принимает крипту напрямую. Для остальных работают виртуальные карты типа Pyypl или RedotPay — заводишь за 10 минут.' 
  },
  { 
    q: 'Какой сервис лучший?', 
    a: 'Зависит от задачи. Для NSFW без ограничений — CrushOn. Для глубоких разговоров — Replika. Для ролевых игр — Character.AI. Сравнение в каталоге.' 
  },
  { 
    q: 'Это вообще легально?', 
    a: 'Да. Все сервисы в каталоге — легальные компании с публичными офисами. Данные шифруются, история не продаётся.' 
  },
];

// Schema.org
const schema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'AIGirlsHub',
  url: 'https://aigirlshub.ru',
};
---

<SiteLayout 
  title="AI-девушки — каталог сервисов 2025"
  description="Сравнение Replika, Character.AI, CrushOn и других. Какой сервис выбрать, как оплатить из России, что работает без VPN."
>
  <script type="application/ld+json" set:html={JSON.stringify(schema)} slot="head" is:inline />

  <main class="home">
    
    <!-- HERO -->
    <section class="hero">
      <Wrapper>
        <p class="hero__eyebrow">Каталог {models.length} сервисов</p>
        <h1 class="hero__title">Найди свою AI-девушку</h1>
        <p class="hero__subtitle">
          Сравнения, обзоры, гайды по оплате из РФ. Без воды и рекламы.
        </p>
      </Wrapper>
    </section>

    <!-- QUICK FILTERS -->
    <section class="filters">
      <Wrapper>
        <nav class="filters__grid">
          {quickFilters.map((filter) => (
            <a href={filter.href} class="filter-btn">{filter.label}</a>
          ))}
        </nav>
      </Wrapper>
    </section>

    <!-- TOP SERVICES -->
    <section class="services">
      <Wrapper>
        <div class="services__header">
          <h2 class="services__title">Популярные</h2>
          <a href={url('/catalog')} class="services__link">
            Все →
          </a>
        </div>
        
        <div class="services__grid">
          {topModels.map((model) => (
            <ServiceCard
              slug={model.slug}
              name={model.name}
              rating={model.rating}
              pricing={model.pricing}
              priceFrom={model.priceFrom}
              tagline={model.tagline}
              description={model.description}
              logo={model.logo}
              status={model.status}
              affiliateUrl={model.affiliateUrl}
              features={model.features}
              advancedFeatures={model.advancedFeatures}
              paymentMethods={model.payment_methods}
            />
          ))}
        </div>
      </Wrapper>
    </section>

    <!-- FAQ -->
    <section class="faq">
      <Wrapper>
        <h2 class="faq__title">Частые вопросы</h2>
        
        <div class="faq__list">
          {faqItems.map((item, index) => (
            <details class="faq__item" open={index === 0}>
              <summary class="faq__question">{item.q}</summary>
              <p class="faq__answer">{item.a}</p>
            </details>
          ))}
        </div>
      </Wrapper>
    </section>

    <!-- CTA -->
    <section class="cta">
      <Wrapper>
        <div class="cta__box">
          <div class="cta__content">
            <p class="cta__title">Не знаешь что выбрать?</p>
            <p class="cta__text">Сравни Replika vs Character.AI, CrushOn vs Candy и другие пары</p>
          </div>
          <a href={url('/compare')} class="cta__btn">Сравнения</a>
        </div>
      </Wrapper>
    </section>

  </main>
</SiteLayout>

<style>
  .home {
    padding-bottom: var(--ids__space-2xl);
  }

  /* ═══════════════════════════════════════════════════════════════
     HERO
     ═══════════════════════════════════════════════════════════════ */
  .hero {
    padding: var(--ids__space-2xl) 0 var(--ids__space-l);
    text-align: center;
  }

  .hero__eyebrow {
    margin: 0 0 var(--ids__space-xs);
    font-size: var(--ids__font-size-small);
    color: var(--ids__text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .hero__title {
    font-size: clamp(2rem, 6vw, 3.5rem);
    font-weight: var(--ids__font-weight-bold);
    line-height: var(--ids__line-height-tight);
    margin: 0;
    color: var(--ids__text-primary);
  }

  .hero__subtitle {
    margin: var(--ids__space-s) 0 0;
    font-size: var(--ids__font-size-body);
    color: var(--ids__text-tertiary);
    max-width: 32em;
    margin-left: auto;
    margin-right: auto;
  }

  /* ═══════════════════════════════════════════════════════════════
     QUICK FILTERS
     ═══════════════════════════════════════════════════════════════ */
  .filters {
    padding-bottom: var(--ids__space-l);
  }

  .filters__grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--ids__space-2xs);
  }

  .filter-btn {
    padding: var(--ids__space-xs) var(--ids__space-s);
    background: transparent;
    border: 1px solid var(--ids__border-default);
    border-radius: var(--ids__radius-s);
    font-size: var(--ids__font-size-small);
    color: var(--ids__text-secondary);
    text-decoration: none;
    transition: 
      background var(--ids__transition-fast),
      border-color var(--ids__transition-fast),
      color var(--ids__transition-fast);
  }

  .filter-btn:hover {
    background: var(--ids__bg-surface);
    border-color: var(--ids__border-strong);
    color: var(--ids__text-primary);
    text-decoration: none;
  }

  /* ═══════════════════════════════════════════════════════════════
     SERVICES GRID
     ═══════════════════════════════════════════════════════════════ */
  .services {
    padding: var(--ids__space-l) 0;
  }

  .services__header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    margin-bottom: var(--ids__space-m);
  }

  .services__title {
    margin: 0;
    font-size: var(--ids__font-size-h2);
    font-weight: var(--ids__font-weight-bold);
  }

  .services__link {
    font-size: var(--ids__font-size-small);
    color: var(--ids__text-tertiary);
    text-decoration: none;
    transition: color var(--ids__transition-fast);
  }

  .services__link:hover {
    color: var(--ids__link);
  }

  .services__grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--ids__space-m);
  }

  @media (width < 900px) {
    .services__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (width < 600px) {
    .services__grid {
      grid-template-columns: 1fr;
    }
  }

  /* ═══════════════════════════════════════════════════════════════
     FAQ
     ═══════════════════════════════════════════════════════════════ */
  .faq {
    padding: var(--ids__space-xl) 0;
  }

  .faq__title {
    margin: 0 0 var(--ids__space-m);
    font-size: var(--ids__font-size-h2);
    font-weight: var(--ids__font-weight-bold);
  }

  .faq__list {
    display: flex;
    flex-direction: column;
    gap: var(--ids__space-2xs);
  }

  .faq__item {
    padding: var(--ids__space-s) var(--ids__space-m);
    background: var(--ids__bg-surface);
    border-radius: var(--ids__radius-s);
    cursor: pointer;
  }

  .faq__item[open] {
    background: var(--ids__bg-surface-hover);
  }

  .faq__question {
    font-size: var(--ids__font-size-small);
    font-weight: var(--ids__font-weight-semibold);
    list-style: none;
    display: flex;
    align-items: center;
    gap: var(--ids__space-xs);
  }

  .faq__question::-webkit-details-marker {
    display: none;
  }

  .faq__question::before {
    content: '+';
    flex-shrink: 0;
    width: 1em;
    color: var(--ids__text-muted);
    font-weight: var(--ids__font-weight-regular);
  }

  .faq__item[open] .faq__question::before {
    content: '−';
  }

  .faq__answer {
    margin: var(--ids__space-xs) 0 0;
    padding-left: calc(1em + var(--ids__space-xs));
    font-size: var(--ids__font-size-small);
    color: var(--ids__text-secondary);
    line-height: var(--ids__line-height-relaxed);
  }

  /* ═══════════════════════════════════════════════════════════════
     CTA
     ═══════════════════════════════════════════════════════════════ */
  .cta {
    padding: var(--ids__space-xl) 0;
  }

  .cta__box {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--ids__space-m);
    padding: var(--ids__space-l);
    background: var(--ids__bg-surface);
    border-radius: var(--ids__radius-m);
  }

  .cta__content {
    flex: 1;
  }

  .cta__title {
    margin: 0;
    font-size: var(--ids__font-size-body);
    font-weight: var(--ids__font-weight-semibold);
    color: var(--ids__text-primary);
  }

  .cta__text {
    margin: var(--ids__space-2xs) 0 0;
    font-size: var(--ids__font-size-small);
    color: var(--ids__text-tertiary);
  }

  .cta__btn {
    flex-shrink: 0;
    padding: var(--ids__space-xs) var(--ids__space-m);
    background: transparent;
    border: 1px solid var(--ids__border-default);
    border-radius: var(--ids__radius-s);
    font-size: var(--ids__font-size-small);
    color: var(--ids__text-secondary);
    text-decoration: none;
    transition: 
      background var(--ids__transition-fast),
      border-color var(--ids__transition-fast),
      color var(--ids__transition-fast);
  }

  .cta__btn:hover {
    background: var(--ids__bg-surface-hover);
    border-color: var(--ids__border-strong);
    color: var(--ids__text-primary);
    text-decoration: none;
  }

  @media (width < 600px) {
    .cta__box {
      flex-direction: column;
      text-align: center;
    }
  }
</style>
