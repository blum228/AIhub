---
/**
 * Звёздный рейтинг
 * @prop rating - число от 0 до 5
 * @prop showNumber - показывать число рядом
 * @prop size - размер: 'S' | 'M' (default)
 */
interface Props {
  rating: number;
  showNumber?: boolean;
  size?: 'S' | 'M';
  class?: string;
}

const { rating, showNumber = true, size = 'M', class: className } = Astro.props;
const classes = ['ids__rating', size !== 'M' && size, className].filter(Boolean).join(' ');

// Округляем до 0.5
const roundedRating = Math.round(rating * 2) / 2;
const fullStars = Math.floor(roundedRating);
const hasHalf = roundedRating % 1 !== 0;
const emptyStars = 5 - fullStars - (hasHalf ? 1 : 0);
---

<div class={classes} title={`Рейтинг: ${rating} из 5`}>
  <span class="ids__rating-stars" aria-hidden="true">
    {Array(fullStars).fill(null).map(() => <span class="star full">★</span>)}
    {hasHalf && <span class="star half">★</span>}
    {Array(emptyStars).fill(null).map(() => <span class="star empty">★</span>)}
  </span>
  {showNumber && <span class="ids__rating-number">{rating.toFixed(1)}</span>}
</div>

<style>
  .ids__rating {
    display: inline-flex;
    align-items: center;
    gap: var(--ids__space-xs);
  }

  .ids__rating-stars {
    display: inline-flex;
    gap: var(--ids__space-2xs);
    font-size: var(--ids__font-size-small);
    line-height: 1;
  }

  .star {
    transition: transform var(--ids__transition-fast);
  }

  .star.full {
    color: var(--ids__accent);
  }

  .star.half {
    position: relative;
    color: var(--ids__text-muted);
  }

  .star.half::before {
    content: '★';
    position: absolute;
    left: 0;
    width: 50%;
    overflow: hidden;
    color: var(--ids__accent);
  }

  .star.empty {
    color: var(--ids__text-muted);
  }

  .ids__rating-number {
    font-size: var(--ids__font-size-small);
    font-weight: var(--ids__font-weight-medium);
    color: var(--ids__text-secondary);
  }

  /* Size S */
  .ids__rating.S {
    gap: var(--ids__space-2xs);
  }

  .ids__rating.S .ids__rating-stars {
    font-size: var(--ids__font-size-micro);
  }

  .ids__rating.S .ids__rating-number {
    font-size: var(--ids__font-size-caption);
  }
</style>
